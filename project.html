<!DOCTYPE html>
<html>
<head lang="en">

    <title>Beautiful Stocks</title>

    <!--Force internet explorer/edge to comply-->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Robert Alger & Andre Carrera">

    <!-- Custom Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">

    <!--W3 Stylesheet-->
    <!--https://www.w3schools.com/w3css/ for documentation-->
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">


    <!--JQUERY-->
    <script
      src="http://code.jquery.com/jquery-3.2.1.min.js"
      integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
      crossorigin="anonymous">
    </script>
    
    <!--Chart script-->
    
    <!--script src="node_modules/chartjs/dist/Chart.js"></script-->



<script>
  $(document).ready(function() {

    $("#tickerButton").click(function(e){
      var value = $("#tickerField").val().toUpperCase();
      console.log(value);
      e.preventDefault();
      var dateString = "2017-10-02";
      var APIkey = "JDLFW3LUQKIPCLUZ";
      var myurl= "https://www.alphavantage.co/query?function=TIME_SERIES_DAILY";
      myurl += "&symbol=" + value;
      myurl += "&apikey=" + APIkey;
      console.log(myurl);

      $.ajax({
        url : myurl,
        dataType : "json",
        success : function(parsed_json) {
            var loopDate = new Date("2017-10-04");
            var graphData = [];
            
            for (i = 0; i < 30; i++ ){
                //loopDate.setDate(loopDate.getdate() - 1)  //THIS HAS BEEN DEPRECATED NEED NEW SOLUTION
                dateString = loopDate.toISOString().split('T')[0];
                console.log(dateString);
                console.log(myurl);
                var open = parsed_json['Time Series (Daily)'][dateString]["1. open"]
                var high = parsed_json['Time Series (Daily)'][dateString]["2. high"]
                var low = parsed_json['Time Series (Daily)'][dateString]["3. low"]
                var closeVal = parsed_json['Time Series (Daily)'][dateString]["4. close"]
                var volume = parsed_json['Time Series (Daily)'][dateString]["5. volume"]
                var dataToPush = {
                    'date': dateString,
                    'openAmt' : open,
                    'highAmt': high,
                    'lowAmt': low,
                    'closeValue': closeVal,
                    'volume': volume
                };
                graphData.push(dataToPush);
                console.log(dataToPush);
                console.log(graphData);
                
                var everything = "<ul>"
                everything += "<li>Open: "+open;
                everything += "<li>High: "+high;
                everything += "<li>Low: "+low;
                everything += "<li>Close: "+closeVal;
                everything += "<li>Volume: "+volume;
                everything += "</ul>";
                $("#stockData").html(everything);
                
           } //End of For Loop
        } //End of AJAX-SUCCESS
      }); //End of AJAX
    });
  });
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>


</head>
<body>

<form class="w3-container">
    <label>Choose Stock</label>
Enter A Stock Ticker: <br/>
<input type="text" id="tickerField" value=""><br>
<input class="w3-input" id="tickerButton" type="submit" value="Submit">
</form>

<div class="w3-display-container" id="stockData">No info</div>
    
    
<canvas id="myChart" width="100px" height="80px"></canvas>
    
    <!--The script for the chart has to be AFTER the chart is initialized-->
    <script>
        var ctx = document.getElementById('myChart').getContext('2d');
        var chart = new Chart(ctx, {
            //Type of chart we want to create
            type: 'line',
            
            //Data for the dataset
            data: {
            labels: ["January", "February", "March", "April", "May", "June", "July"],
            datasets: [{
                label: "My First dataset",
                backgroundColor: 'rgb(255, 99, 132)',
                bordercolor: 'rgb(255, 99, 132)',
                data: [10,10,10,10,10,10,10],
                }]
            },
            //Configuration options
            options:{}
        });
    </script> <!--End of chart script-->


</body>
</html>
