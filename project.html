<!DOCTYPE html>
<html>
<head lang="en">

    <title>Beautiful Stocks</title>

    <!--Force internet explorer/edge to comply-->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Robert Alger & Andre Carrera">

    <!-- Custom Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">

    <!--W3 Stylesheet-->
    <!--https://www.w3schools.com/w3css/ for documentation-->
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">


    <!--JQUERY-->
    <script
      src="http://code.jquery.com/jquery-3.2.1.min.js"
      integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
      crossorigin="anonymous">
    </script>
    
    <!--Joda Time-->
    <!--CHEATSHEET:  https://github.com/js-joda/js-joda/blob/HEAD/CheatSheet.md-->
    <script src="node_modules/js-joda/dist/js-joda.min.js"></script>
    
    <!--Chart script-->
    <!--script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script-->
    <script src="node_modules/chart.js/dist/Chart.js"></script>

    


<script>
  $(document).ready(function() {

    $("#tickerButton").click(function(e){
      var value = $("#tickerField").val().toUpperCase();
      console.log(value);
      e.preventDefault();
      var APIkey = "JDLFW3LUQKIPCLUZ";
      var myurl= "https://www.alphavantage.co/query?function=TIME_SERIES_DAILY";
      myurl += "&symbol=" + value;
      myurl += "&apikey=" + APIkey;
      console.log(myurl);
      var LocalDate = JSJoda.LocalDate;
      console.log("JS JODA DATE " + LocalDate.now())
        
        
      $.ajax({
        url : myurl,
        dataType : "json",
        success : function(parsed_json) {
            var loopDate = LocalDate.now();
            var graphData = [];
            var numberOfDays = 2
            for (i = 0; i < numberOfDays; i++ ){
                loopDate = loopDate.minusDays(1); 
                console.log("DAYS minus 1: " + loopDate);
                //console.log(dateString);
                console.log(myurl);
                var open = parsed_json['Time Series (Daily)'][loopDate.toString()]["1. open"]
                var high = parsed_json['Time Series (Daily)'][loopDate.toString()]["2. high"]
                var low = parsed_json['Time Series (Daily)'][loopDate.toString()]["3. low"]
                var closeVal = parsed_json['Time Series (Daily)'][loopDate.toString()]["4. close"]
                var volume = parsed_json['Time Series (Daily)'][loopDate.toString()]["5. volume"]
                var dataToPush = {
                    'date': loopDate.toString(),
                    'openAmt' : open,
                    'highAmt': high,
                    'lowAmt': low,
                    'closeValue': closeVal,
                    'volume': volume
                };
                graphData.push(dataToPush);
                console.log(dataToPush);
                console.log(graphData);
                
                var everything = "<ul>"
                everything += "<li>Open: "+open;
                everything += "<li>High: "+high;
                everything += "<li>Low: "+low;
                everything += "<li>Close: "+closeVal;
                everything += "<li>Volume: "+volume;
                everything += "</ul>";
                $("#stockData").html(everything);
                
           } //End of For Loop
            
            
            //These were taken directly from the chartjs developers
            //http://www.chartjs.org/docs/latest/developers/updates.html
            
            //CLEAR THE CHART
            function removeData(chart) {
                console.log("DATA LABELS: " + chart.data.labels)
            chart.data.labels.pop();
            chart.data.datasets.forEach((dataset) => {
                dataset.data.pop();
            });
            chart.update();
            }
           
            
            //PUSH THE DATA TO THE CHART
            function addData(chart, label, data) {
                chart.data.labels.push(label);
                chart.data.datasets.forEach((dataset) => {
                    dataset.data.push(data);
                });
            chart.update();
            }
            
            console.log(graphData.size())
            var ctx = document.getElementById("myChart");
            removeData(ctx);
            for (i = 0; i < graphData.size(); i++){
                addData(ctx,graphData['date'],graphData['open']);
            }
            
            
            
        } //End of AJAX-SUCCESS
      }); //End of AJAX
    });
  });
</script>




</head>
<body>

<form class="w3-container">
    <label>Choose Stock</label>
Enter A Stock Ticker: <br/>
<input type="text" id="tickerField" value=""><br>
<input class="w3-input" id="tickerButton" type="submit" value="Submit">
</form>

<div class="w3-display-container" id="stockData">No info</div>
    
    
<canvas id="myChart" width="100px" height="80px"></canvas>
    
    <!--The script for the chart has to be AFTER the chart is initialized-->
    <script>
        var ctx = document.getElementById('myChart').getContext('2d');
        var chart = new Chart(ctx, {
            //Type of chart we want to create
            type: 'line',
            
            //Data for the dataset
            data: {
            labels: ["January", "February", "March", "April", "May", "June", "July"],
            datasets: [{
                label: "My First dataset",
                backgroundColor: 'rgb(255, 99, 132)',
                bordercolor: 'rgb(255, 99, 132)',
                data: [10,10,10,10,10,10,10],
                }]
            },
            //Configuration options
            options:{}
        });
    </script> <!--End of chart script-->


</body>
</html>
